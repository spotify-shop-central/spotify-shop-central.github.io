# Firebase App Hosting configuration
# https://firebase.google.com/docs/app-hosting

# Runtime configuration
runConfig:
  # Node.js runtime version
  runtime: nodejs20
  
  # Environment variables from Google Secret Manager
  env:
    NODE_ENV: production
    SPOTIFY_CLIENT_ID: ${{ secrets.projects/$PROJECT_ID/secrets/spotify-client-id/versions/latest }}
    SPOTIFY_CLIENT_SECRET: ${{ secrets.projects/$PROJECT_ID/secrets/spotify-client-secret/versions/latest }}
    OPENROUTER_KEY: ${{ secrets.projects/$PROJECT_ID/secrets/openrouter-key/versions/latest }}
    SPOTIFY_REDIRECT_URI: ${{ secrets.projects/$PROJECT_ID/secrets/spotify-redirect-uri/versions/latest }}

# Build configuration
buildConfig:
  # Build commands
  commands:
    # Install dependencies
    - name: "Install dependencies"
      command: "yarn install"
      
    # Build the Next.js application
    - name: "Build Next.js app"
      command: "yarn build"
      
  # Build environment variables from Google Secret Manager
  env:
    NODE_ENV: production
    SPOTIFY_CLIENT_ID: ${{ secrets.projects/$PROJECT_ID/secrets/spotify-client-id/versions/latest }}
    SPOTIFY_CLIENT_SECRET: ${{ secrets.projects/$PROJECT_ID/secrets/spotify-client-secret/versions/latest }}
    OPENROUTER_KEY: ${{ secrets.projects/$PROJECT_ID/secrets/openrouter-key/versions/latest }}
    SPOTIFY_REDIRECT_URI: ${{ secrets.projects/$PROJECT_ID/secrets/spotify-redirect-uri/versions/latest }}

# Optional: Resource allocation
resources:
  # CPU and memory allocation for the build
  cpu: 2
  memory: 4Gi
  
# Optional: Build timeout (in seconds)
timeout: 1200

# Optional: Custom headers and redirects
headers:
  - source: "**"
    headers:
      - key: "X-Frame-Options"
        value: "DENY"
      - key: "X-Content-Type-Options"
        value: "nosniff"

# Optional: Redirect configuration
redirects:
  - source: "/home"
    destination: "/"
    type: 302 